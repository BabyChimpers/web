<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stake NFTs</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=VT323&family=Pixelify+Sans&display=swap">
    <style>
        /* Global styles */
        body {
            font-family: "VT323", monospace;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Prevent horizontal scrollbar */
        }
        .container {
            text-align: center;
            max-width: 600px;
            margin: auto;
            padding: 20px;
        }
        h1 {
            margin-bottom: 20px;
            font-family: Pixelify Sans, sans-serif;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-family: "Pixelify Sans", sans-serif;
        }
        button:hover {
            background-color: #0056b3;
        }
        input[type="text"] {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        input[type="text"]:focus {
            border-color: #007bff;
        }
        /* Header styles */
        header {
            background-color: #333;
            color: #fff;
            padding: 10px 0;
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        .title {
            font-size: 24px;
            font-weight: bold;
        }
        /* Wallet info styles */
        .wallet-info {
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
            display: none;
            overflow-wrap: break-word; /* Wrap long text */
        }
        .wallet-info p {
            margin: 5px 0;
        }
        .wallet-info h2 {
            text-align: center;
        }
        /* Action buttons styles */
        .action-buttons {
            margin-top: 20px;
            display: none;
        }
        /* NFT input styles */
        .nft-input {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            display: none;
        }
        /* Dashboard styles */
        .dashboard {
            margin-top: 20px;
            display: none;
        }
        .dashboard-content {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: left;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
        .dashboard-content h2 {
            text-align: center;
        }
        .dashboard-section {
            margin-top: 20px;
        }
        .dashboard-section h3 {
            text-align: center;
            margin-bottom: 10px;
        }
        .dashboard-context {
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            background-color: #f0f0f0;
            text-align: left;
        }
        .dashboard-context h3 {
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1 class="title">Stake NFTs</h1>
        </div>
    </header>
    <div class="container">
        <div id="message"></div>
        <div class="wallet-info">
            <h2>Wallet Information</h2>
            <p><strong>Address:</strong> <span id="walletAddress"></span></p>
            <p><strong>Balance:</strong> <span id="ethBalance"></span> BONE</p>
        </div>
        <button id="connectButton">Connect Wallet</button>
        <div class="action-buttons">
            <button onclick="toggleNFTInput('stake')">Stake NFT</button>
            <button onclick="toggleNFTInput('unstake')">Unstake NFT</button>
            <button onclick="toggleDashboard()">Dashboard</button>
        </div>
        <div class="nft-input" id="stakeNFTInput">
            <input type="text" placeholder="Enter NFT ID" id="stakeNFTID">
            <button onclick="stakeNFT()">Stake</button>
        </div>
        <div class="nft-input" id="unstakeNFTInput">
            <input type="text" placeholder="Enter NFT ID" id="unstakeNFTID">
            <button onclick="unstakeNFT()">Unstake</button>
        </div>
        <div class="dashboard" id="dashboard">
            <div class="dashboard-content">
                <h2>Dashboard</h2>
                <div class="dashboard-context">
                    <h3>Global Stats</h3>
                    <p><strong>NFT Staked:</strong> <span id="globalStaked">0</span></p>
                    <p><strong>NFT Held: (<span id="numberHeld">0</span>) <span id="idHeld"></span></strong></p>
                </div>
                <div class="dashboard-context">
                    <h3>Staked NFTs</h3>
                    <p><strong>NFT ID:</strong> <span id="stakedNFTs">-</span></p>
                </div>
                <div class="dashboard-context">
                    <h3>Accumulated Rewards</h3>
                    <p><strong>Rewards:</strong> <span id="accumulatedRewards">0</span> CFUN</p>
                    <button onclick="claimRewards()">Claim Rewards</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Web3.js library -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>

    <script>
        // Initialize Web3
        let web3;
        if (window.ethereum) {
            web3 = new Web3(window.ethereum);
        } else if (window.web3) {
            web3 = new Web3(window.web3.currentProvider);
        } else {
            console.error('No Ethereum provider detected. You should consider trying MetaMask!');
        }

        const stakeabi = [
            [{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"claimTokens","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_emission_rate","type":"uint256"}],"name":"newEmissionRate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_nft","type":"address"}],"name":"newNft","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"}],"name":"newToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"bytes","name":"","type":"bytes"}],"name":"onERC721Received","outputs":[{"internalType":"bytes4","name":"","type":"bytes4"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"stake","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address payable","name":"_to","type":"address"}],"name":"transferValue","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"unstake","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"withdrawTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_token","type":"address"},{"internalType":"address","name":"_nft","type":"address"},{"internalType":"uint256","name":"_emission_rate","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"calculateTokens","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"emission_rate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"nft","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"price","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"stakedNFT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"token","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"tokenOwnerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"tokenStakedAt","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"totalStaked","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"viewStakedNFTs","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"}]
        ];
        const nftabi = [
            [{"inputs":[{"internalType":"string","name":"_name","type":"string"},{"internalType":"string","name":"_symbol","type":"string"},{"internalType":"string","name":"_initBaseURI","type":"string"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address[100]","name":"_users","type":"address[100]"}],"name":"add100PresaleUsers","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"addPresaleUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"baseExtension","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"baseURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"cost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxMintAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_to","type":"address"},{"internalType":"uint256","name":"_mintAmount","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"mintID","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bool","name":"_state","type":"bool"}],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"presaleCost","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"presaleWallets","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"removePresaleUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"removeWhitelistUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_newBaseExtension","type":"string"}],"name":"setBaseExtension","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_newBaseURI","type":"string"}],"name":"setBaseURI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newCost","type":"uint256"}],"name":"setCost","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newCost","type":"uint256"}],"name":"setPresaleCost","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_newmaxMintAmount","type":"uint256"}],"name":"setmaxMintAmount","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"index","type":"uint256"}],"name":"tokenOfOwnerByIndex","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_owner","type":"address"}],"name":"walletOfOwner","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"whitelistUser","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"whitelisted","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"payable","type":"function"}]
        ];

        const nftaddr = "0x73FfF481C86B73Ab0b0907f0AaCb262eD9ae4807";
        const stakeaddr = "0x4FD2223a8c71b53C22ce0957C7B811A1936AbB65";

        const stakenft = new web3.eth.Contract(stakeabi, stakeaddr);
        const nft = new web3.eth.Contract(nftabi, nftaddr);

        // Handle Connect Wallet button click
        document.getElementById('connectButton').addEventListener('click', async () => {
            try {
                // Request connection to MetaMask
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                // Log the connected address
                console.log('Connected Address:', accounts[0]);
                // Show success message
                document.getElementById('message').innerText = 'Wallet connected successfully!';
                // Change title to Stake NFTs
                document.querySelector('.title').innerText = 'Stake NFTs';
                // Show wallet information
                showWalletInfo(accounts[0]);
                // Show action buttons
                document.querySelector('.action-buttons').style.display = 'block';
                // Change connect button text to "Connected"
                document.getElementById('connectButton').innerText = 'Connected';
                // Remove connected button after 5 seconds
                setTimeout(() => {
                    document.getElementById('connectButton').style.display = 'none';
                }, 5000);
            } catch (error) {
                console.error('Failed to connect MetaMask:', error);
                // Show error message
                document.getElementById('message').innerText = 'Error: Failed to connect wallet';
            }
        });

        // Function to show wallet information
        async function showWalletInfo(address) {
            // Display wallet address
            document.getElementById('walletAddress').innerText = address;
            // Get ETH balance
            const balance = await web3.eth.getBalance(address);
            // Convert balance from wei to ETH and round to 3 decimal places
            const ethBalance = (parseFloat(web3.utils.fromWei(balance, 'ether'))).toFixed(3);
            // Display ETH balance
            document.getElementById('ethBalance').innerText = ethBalance;
            // Show wallet info div
            document.querySelector('.wallet-info').style.display = 'block';
        }

        // Function to toggle display of NFT input div
        function toggleNFTInput(action) {
            // Hide all NFT input divs
            document.querySelectorAll('.nft-input').forEach((div) => {
                div.style.display = 'none';
            });
            // Show the corresponding NFT input div
            if (action === 'stake') {
                document.getElementById('stakeNFTInput').style.display = 'block';
            } else if (action === 'unstake') {
                document.getElementById('unstakeNFTInput').style.display = 'block';
            }
        }

        // Function to toggle display of dashboard
        function toggleDashboard() {
            // Show dashboard
            const dashboard = document.getElementById('dashboard');
            if (dashboard.style.display === 'block') {
                dashboard.style.display = 'none';
            } else {
                dashboard.style.display = 'block';
            }
        }

        // Function to handle staking NFT
        function stakeNFT() {
            // Get the input value (NFT ID)
            const nftID = document.getElementById('stakeNFTID').value;
            try {
                const stake = await stakenft.methods.stake(nftID).send({ from: accounts[0]}).then(function(result) {
                    console.log("staked nftid:", nftID);
                };
            } catch(error){
                console.error("an error occured:",error);
            }
        }

        // Function to handle unstaking NFT
        function unstakeNFT() {
            // Get the input value (NFT ID)
            const nftID = document.getElementById('unstakeNFTID').value;
            // Add your unstaking logic here
            console.log('Unstake NFT with ID:', nftID);
        }

        // Function to claim rewards
        function claimRewards() {
            // Add your logic to claim rewards here
            console.log('Rewards claimed');
        }
    </script>
</body>
</html>
